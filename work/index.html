<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<link rel="icon" href="../logo.png" sizes="32x32">
	<link href="css/bootstrap.min.css" type="text/css" rel="stylesheet">
	<link href="css/fileinput.min.css" type="text/css" rel="stylesheet">
	<script src="js/jquery-3.4.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/fileinput.min.js"></script>
	<script src="js/zh.js"></script>
	<title>上传作业</title>
</head>

<body>
	<nav></nav>
	<div class="container">
		<br>



		<br>
		<div>
			<p class="h2">科目：<span class="text-info">综合</span></p>
			<p class="h4">备注：按布置作业的时间交，正常的playground文件目录如下图。都交压缩包。</p>
			<img src="example.jpg">
			<p class="h4">截止时间：<span class="text-danger">9月19日（星期四）</p>
		</div>
		<p class="h5">请选择作业布置的时间：</p>
		<div id="choose" class="">
			<button index="0" type="button" class="col-lg-3 m-3 col-12 btn btn-secondary">Swift Work1 9/6</button>
			<button index="1" type="button" class="col-lg-3 m-3 col-12 btn btn-secondary">Swift Work2 9/12</button>
			<button index="2" type="button" class="col-lg-3 m-3 col-12 btn btn-secondary">Android Work1 9/10</button>
			<button index="3" type="button" class="col-lg-3 m-3 col-12 btn btn-secondary">Swift Work3 9/19</button>
		</div>
		<br>
		<div class="file-loading">
			<input id="file" name="file" type="file" data-theme="fas">
		</div>
		<div id="errorBlock" class="help-block"></div>
		<p id="result" class="h3"></p>
		<br>
		<div>
			<p class="h5">当前已上传文件(建议使用 <kbd>Ctrl + F</kbd> 搜索)：</p>
			<div id="uploaded"></div>
		</div>

	</div>



	<footer></footer>

	<script>

		// 设置上传文件夹，临时使用静态数据解决，以后使用数据库。
		$('#choose').on("click", '.btn', function () {
			$(this).removeClass('btn-secondary').addClass('btn-primary');
			$(this).siblings().removeClass('btn-primary').addClass('btn-secondary');
			index = $(this).attr("index");
			if (index == '0') {
				subject = "swift"
				endDate = "0906"
			}
			if (index == '1') {
				subject = "swift"
				endDate = "0912"
			}
			if (index == '2') {
				subject = "android"
				endDate = "0910"
			}
			if (index == '3') {
				subject = "swift"
				endDate = "0919"
			}
			$("#result").text("");
			$("#uploaded").html("<h5>查询中</h5>");
			file_dir = subject + "_" + endDate;
			file.fileinput('refresh', { uploadExtraData: { 'dir': file_dir, } }).fileinput('clear').fileinput('enable');
			getFileList();

		});

		//载入导航栏和底部栏
		$(document).ready(function () {
			$("nav").load("../part/nav.html");
			$("footer").load("../part/footer.php");
		});

		// 初始化上传
		var file = $("#file");
		file.fileinput({
			uploadUrl: 'receive.php',  // post地址
			allowedFileExtensions: ['txt', 'doc', 'docx', 'ppt', 'pptx', 'xls', 'xlsx', 'zip', 'rar', 'php'],  // 允许的上传地址
			uploadAsync: true,  // 异步上传
			theme: 'fas',  // 主题
			language: 'zh',  // 语言
			showPreview: false,  // 预览
			maxFileSize: 5120, // 限制大小
			enctype: 'multipart/form-data',  // 文件编码
			elErrorContainer: "#errorBlock"
		});
		// 事件：异步上传中
		file.on("filepreajax", function () {
			$("#result").text("上传中。。。");
		});
		// 事件：上传完成后
		file.on("fileuploaded", function (event, data, previewId, index) {
			result = data.response.request;
			$("#result").text(result);
			alert(result);
			getFileList();
		})

		//获取已上传列表
		function getFileList() {
			$.post("receive.php",
				{
					list: "",
					dir: file_dir,
				},
				function (data, status) {
					list = jQuery.parseJSON(data);
					var myDate = new Date();
					var mytime = myDate.toLocaleTimeString();
					$("#uploaded").html("<p class='h5'>刷新时间：<span class='text-info'>" + mytime + "<span></p><br>");
					$.each(list, function (i, v) {
						$("#uploaded").html(function (i, o) {
							return o + "<p>" + v + "</p>"
						});
					});
				});
		}
	</script>
</body>

</html>